import{r as i}from"./react-Bt3bhBdA.js";function A(e,a,t){let[r,s]=i.useState(e||a),l=i.useRef(e!==void 0),n=e!==void 0;i.useEffect(()=>{let c=l.current;c!==n&&console.warn(`WARN: A component changed from ${c?"controlled":"uncontrolled"} to ${n?"controlled":"uncontrolled"}.`),l.current=n},[n]);let d=n?e:r,v=i.useCallback((c,...u)=>{let V=(f,...$)=>{t&&(Object.is(d,f)||t(f,...$)),n||(d=f)};typeof c=="function"?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),s(($,...p)=>{let b=c(n?d:$,...p);return V(b,...u),n?$:b})):(n||s(c),V(c,...u))},[n,d,t]);return[d,v]}const D={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},R={...D,customError:!0,valid:!1},m={isInvalid:!1,validationDetails:D,validationErrors:[]},T=i.createContext({}),I="__formValidationState"+Date.now();function Q(e){if(e[I]){let{realtimeValidation:a,displayValidation:t,updateValidation:r,resetValidation:s,commitValidation:l}=e[I];return{realtimeValidation:a,displayValidation:t,updateValidation:r,resetValidation:s,commitValidation:l}}return _(e)}function _(e){let{isInvalid:a,validationState:t,name:r,value:s,builtinValidation:l,validate:n,validationBehavior:d="aria"}=e;t&&(a||(a=t==="invalid"));let v=a?{isInvalid:!0,validationErrors:[],validationDetails:R}:null,c=i.useMemo(()=>M(F(n,s)),[n,s]);l!=null&&l.validationDetails.valid&&(l=null);let u=i.useContext(T),V=i.useMemo(()=>r?Array.isArray(r)?r.flatMap(o=>x(u[o])):x(u[r]):[],[u,r]),[f,$]=i.useState(u),[p,b]=i.useState(!1);u!==f&&($(u),b(!1));let E=i.useMemo(()=>M(p?[]:V),[p,V]),O=i.useRef(m),[y,g]=i.useState(m),S=i.useRef(m),w=()=>{if(!k)return;C(!1);let o=c||l||O.current;h(o,S.current)||(S.current=o,g(o))},[k,C]=i.useState(!1);return i.useEffect(w),{realtimeValidation:v||E||c||l||m,displayValidation:d==="native"?v||E||y:v||E||c||l||y,updateValidation(o){d==="aria"&&!h(y,o)?g(o):O.current=o},resetValidation(){let o=m;h(o,S.current)||(S.current=o,g(o)),d==="native"&&C(!1),b(!0)},commitValidation(){d==="native"&&C(!0),b(!0)}}}function x(e){return e?Array.isArray(e)?e:[e]:[]}function F(e,a){if(typeof e=="function"){let t=e(a);if(t&&typeof t!="boolean")return x(t)}return[]}function M(e){return e.length?{isInvalid:!0,validationErrors:e,validationDetails:R}:null}function h(e,a){return e===a?!0:e&&a&&e.isInvalid===a.isInvalid&&e.validationErrors.length===a.validationErrors.length&&e.validationErrors.every((t,r)=>t===a.validationErrors[r])&&Object.entries(e.validationDetails).every(([t,r])=>a.validationDetails[t]===r)}function U(e={}){let{isReadOnly:a}=e,[t,r]=A(e.isSelected,e.defaultSelected||!1,e.onChange);function s(n){a||r(n)}function l(){a||r(!t)}return{isSelected:t,setSelected:s,toggle:l}}function W(e){let[a,t]=A(e.isOpen,e.defaultOpen||!1,e.onOpenChange);const r=i.useCallback(()=>{t(!0)},[t]),s=i.useCallback(()=>{t(!1)},[t]),l=i.useCallback(()=>{t(!a)},[t,a]);return{isOpen:a,setOpen:t,open:r,close:s,toggle:l}}export{U as $,A as a,W as b,Q as c,m as d,I as e};
